<?xml version="1.0" encoding="ISO-8859-1"?>
<!-- Gateway-created setup include file for user ActiveConsole3 at 192.168.142.1 -->
<gateway compatibility="1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://schema.itrsgroup.com/GA3.2.0-150730/gateway.xsd">
	<probes>
		<probeGroup name="Custom">
			<probeGroup name="StandardBank">
				<probe name="devops_custom_fkm">
					<hostname>localhost</hostname>
					<port>8907</port>
				</probe>
			</probeGroup>
		</probeGroup>
	</probes>
	<managedEntities>
		<managedEntityGroup name="Custom">
			
		</managedEntityGroup>
		<managedEntityGroup name="AFRICA">
			<attribute name="REGION">AFRICA</attribute>
			<attribute name="PRODUCT">GENEOS</attribute>
			<managedEntityGroup name="JOHANNESBURG">
				<attribute name="CITY">JOHANNESBURG</attribute>
				<managedEntityGroup name="StandardBank">
					<managedEntityGroup name="FKM">
						<managedEntity name="custom_fkm">
							<probe ref="devops_custom_fkm"/>
							<addTypes>
								<type ref="StandardBank FKM Examples"/>
							</addTypes>
						</managedEntity>
					</managedEntityGroup>
				</managedEntityGroup>
			</managedEntityGroup>
		</managedEntityGroup>
	</managedEntities>
	<types>
		<typeGroup name="Custom">
			<type name="StandardBank FKM Examples">
				<sampler ref="Logfile example 1"/>
				<sampler ref="Logfile example 2"/>
				<sampler ref="Logfile example 3"/>
				<sampler disabled="false" ref="Count Logfile example 4"/>
				<sampler ref="MQ Channel Count" disabled="true"/>
			</type>
		</typeGroup>
	</types>
	<samplers>
		<sampler name="Logfile example 1">
			<var-group>
				<data>CUSTOM FKM</data>
			</var-group>
			<sampleInterval>
				<data>5</data>
			</sampleInterval>
			<plugin>
				<fkm>
					<display>
						<triggerMode>MULTIPLE</triggerMode>
					</display>
					<files>
						<file>
							<source>
								<filename>
									<data>/opt/geneos/gateway/resources/standardbank/fkm/example1.log</data>
								</filename>
							</source>
							<tables>
								<table>
									<severity>fail</severity>
									<keyTable>
										<data>
											<keys>
												<key>
													<setKey>
														<match>
															<searchString>
																<data>if eth2 down</data>
															</searchString>
															<rules>REGEXP</rules>
														</match>
													</setKey>
													<clearTime>
														<data>180</data>
													</clearTime>
												</key>
											</keys>
										</data>
									</keyTable>
								</table>
								<table>
									<severity>fail</severity>
									<keyTable>
										<data>
											<keys>
												<key>
													<setKey>
														<match>
															<searchString>
																<data>if (.*) down</data>
															</searchString>
															<rules>REGEXP</rules>
														</match>
													</setKey>
													<clearKey>
														<match>
															<searchString>
																<data>if $1 up</data>
															</searchString>
															<rules>REGEXP</rules>
														</match>
													</clearKey>
													<clearTime>
														<data>45</data>
													</clearTime>
												</key>
											</keys>
										</data>
									</keyTable>
								</table>
							</tables>
						</file>
					</files>
				</fkm>
			</plugin>
		</sampler>
		<sampler name="Logfile example 2">
			<var-group>
				<data>CUSTOM FKM</data>
			</var-group>
			<sampleInterval>
				<data>5</data>
			</sampleInterval>
			<plugin>
				<fkm>
					<display>
						<columns>
							<column>status</column>
							<column>fileOwner</column>
							<column>triggerCount</column>
							<column>triggerDetails</column>
							<column>secondsSinceLastTrigger</column>
						</columns>
						<triggerMode>SINGLE_GROUPED_MESSAGE</triggerMode>
					</display>
					<singleTriggerCleartimes>
						<data>true</data>
					</singleTriggerCleartimes>
					<files>
						<file>
							<source>
								<filename>
									<data>/opt/geneos/gateway/resources/standardbank/fkm/example2.log</data>
								</filename>
							</source>
							<tables>
								<table>
									<severity>fail</severity>
									<keyTable>
										<data>
											<keys>
												<key>
													<setKey>
														<match>
															<searchString>
																<data>if (.*) down</data>
															</searchString>
															<rules>REGEXP</rules>
														</match>
													</setKey>
													<clearKey>
														<match>
															<searchString>
																<data/>
															</searchString>
														</match>
													</clearKey>
													<clearTime>
														<data>60</data>
													</clearTime>
												</key>
											</keys>
										</data>
									</keyTable>
								</table>
							</tables>
						</file>
					</files>
				</fkm>
			</plugin>
		</sampler>
		<sampler name="Logfile example 3">
			<var-group>
				<data>CUSTOM FKM</data>
			</var-group>
			<plugin>
				<fkm>
					<display>
						<triggerMode>MULTIPLE</triggerMode>
					</display>
					<isPCREMode>
						<data>true</data>
					</isPCREMode>
					<files>
						<file>
							<source>
								<filename>
									<data>/opt/geneos/gateway/resources/standardbank/fkm/example3.log</data>
								</filename>
							</source>
							<tables>
								<table>
									<severity>fail</severity>
									<keyTable>
										<data>
											<keys>
												<key>
													<setKey>
														<match>
															<searchString>
																<data>(.*) </data>
															</searchString>
															<rules>REGEXP</rules>
														</match>
													</setKey>
													<extractors>
														<extractor>
															<name>
																<data>from</data>
															</name>
															<regex>
																<data>(.*):\[.*\]  INFO - Elapsed time : .*</data>
															</regex>
														</extractor>
														<extractor>
															<name>
																<data>original_date</data>
															</name>
															<regex>
																<data>Reporting-Fxo:\[(.*)\]  INFO </data>
															</regex>
														</extractor>
														<extractor>
															<name>
																<data>latency</data>
															</name>
															<regex>
																<data>Elapsed time : (.*)milliseconds \(AsyncContribTask.*</data>
															</regex>
														</extractor>
														<extractor>
															<name>
																<data>severity</data>
															</name>
															<regex>
																<data>Reporting-Fxo:\[.*\]  (.*) - Elapsed time .*</data>
															</regex>
														</extractor>
													</extractors>
												</key>
											</keys>
										</data>
									</keyTable>
								</table>
							</tables>
							<rewind>
								<data>true</data>
							</rewind>
						</file>
					</files>
				</fkm>
			</plugin>
			<dataviews>
				<dataview name="regex range">
					<additions>
						<var-headlines>
							<data>
								<headline>
									<data>range1</data>
								</headline>
							</data>
						</var-headlines>
					</additions>
				</dataview>
			</dataviews>
		</sampler>
		<sampler name="Count Logfile example 4">
			<var-group>
				<data>CUSTOM FKM</data>
			</var-group>
			<sampleInterval>
				<data>5</data>
			</sampleInterval>
			<plugin>
				<fkm>
					<display>
						<columns>
							<column>status</column>
							<column>secondsSinceLastModified</column>
							<column>lastModificationTime</column>
							<column>status</column>
						</columns>
					</display>
					<isPCREMode>
						<data>true</data>
					</isPCREMode>
					<files>
						<file>
							<source>
								<filename>
									<data>/opt/geneos/gateway/resources/standardbank/fkm/count_example4.log</data>
								</filename>
							</source>
							<tables>
								<table>
									<severity>warning</severity>
									<keyTable>
										<data>
											<keys>
												<key>
													<setKey>
														<match>
															<searchString>
																<data>.*</data>
															</searchString>
															<rules>REGEXP</rules>
														</match>
													</setKey>
													<clearTime>
														<data>5</data>
													</clearTime>
													<extractors>
														<extractor>
															<name>
																<data>count</data>
															</name>
															<regex>
																<data>(.*)</data>
															</regex>
														</extractor>
													</extractors>
												</key>
											</keys>
										</data>
									</keyTable>
								</table>
							</tables>
						</file>
					</files>
				</fkm>
			</plugin>
		</sampler>
		<samplerGroup name="Problem">
			<sampler name="MQ Channel Count">
				<sampleInterval>
					<data>5</data>
				</sampleInterval>
				<plugin>
					<fkm>
						<display>
							<columns>
								<column>status</column>
								<column>secondsSinceLastModified</column>
								<column>lastModificationTime</column>
								<column>status</column>
							</columns>
						</display>
						<isPCREMode>
							<data>true</data>
						</isPCREMode>
						<files>
							<file>
								<source>
									<filename>
										<data>/opt/geneos/gateway/resources/standardbank/fkm/count_example4.log</data>
									</filename>
								</source>
								<tables>
									<table>
										<severity>warning</severity>
										<keyTable>
											<data>
												<keys>
													<key>
														<setKey>
															<updated>UPDATED</updated>
														</setKey>
														<clearTime>
															<data>5</data>
														</clearTime>
														<extractors>
															<extractor>
																<name>
																	<data>count</data>
																</name>
																<regex>
																	<data>(.*)</data>
																</regex>
															</extractor>
														</extractors>
													</key>
												</keys>
											</data>
										</keyTable>
									</table>
								</tables>
							</file>
						</files>
					</fkm>
				</plugin>
			</sampler>
		</samplerGroup>
	</samplers>
	<actions>
		<action name="Count to logfile example4">
			<script>
				<exeFile>/opt/geneos/gateway/resources/standardbank/fkm/count_log_to_file.sh</exeFile>
				<arguments>
					<data/>
				</arguments>
				<runLocation>gateway</runLocation>
			</script>
		</action>
	</actions>
	<effects>
		<effect name="Alert to log">
			<script>
				<exeFile>/opt/geneos/gateway/resources/standardbank/fkm/log_to_file.sh</exeFile>
				<arguments>
					<data/>
				</arguments>
				<runLocation>gateway</runLocation>
			</script>
		</effect>
	</effects>
	<rules>
		<ruleGroup name="AFRICA">
			<ruleGroup name="JOHANNESBURG">
				<ruleGroup name="STANDARDBANK">
					<rule name="example1 - status">
						<targets>
							<target>/geneos/gateway[(@name=&quot;DevOps_Gateway&quot;)]/directory/probe[(@name=&quot;devops_custom_fkm&quot;)]/managedEntity[(@name=&quot;custom_fkm&quot;)]/sampler[(@name=&quot;Logfile example 1&quot;)][(@type=&quot;StandardBank FKM Examples&quot;)]/dataview[(@name=&quot;Logfile example 1&quot;)]/rows/row/cell[(@column=&quot;status&quot;)]</target>
						</targets>
						<priority>1</priority>
						<pathAliases>
							<pathAlias name="triggerdetails">ancestor-or-self::managedEntity/sampler/dataview[(@name=&quot;Logfile example 1&quot;)]/rows/row/cell[(@column=&quot;triggerDetails&quot;)]</pathAlias>
						</pathAliases>
						<block>
							<set>
								<var ref="trigger"/>
								<maximum>
									<dataItems>
										<pathAlias ref="triggerdetails"/>
										<property>state/@severity</property>
									</dataItems>
								</maximum>
							</set>
							<if>
								<like>
									<dataItem>
										<property>@value</property>
									</dataItem>
									<string>OK</string>
								</like>
								<transaction>
									<update>
										<property>state/@severity</property>
										<severity>ok</severity>
									</update>
								</transaction>
								<if>
									<like>
										<dataItem>
											<property>@value</property>
										</dataItem>
										<string>NOT*</string>
									</like>
									<transaction>
										<update>
											<property>state/@severity</property>
											<severity>warning</severity>
										</update>
									</transaction>
									<if>
										<and>
											<like>
												<dataItem>
													<property>@value</property>
												</dataItem>
												<string>FAIL*</string>
											</like>
											<equal>
												<maximum>
													<dataItems>
														<pathAlias ref="triggerdetails"/>
														<property>state/@severity</property>
													</dataItems>
												</maximum>
												<integer>3</integer>
											</equal>
										</and>
										<transaction>
											<update>
												<property>state/@severity</property>
												<severity>critical</severity>
											</update>
										</transaction>
										<if>
											<and>
												<like>
													<dataItem>
														<property>@value</property>
													</dataItem>
													<string>FAIL*</string>
												</like>
												<equal>
													<maximum>
														<dataItems>
															<pathAlias ref="triggerdetails"/>
															<property>state/@severity</property>
														</dataItems>
													</maximum>
													<integer>2</integer>
												</equal>
											</and>
											<transaction>
												<update>
													<property>state/@severity</property>
													<severity>warning</severity>
												</update>
											</transaction>
											<transaction>
												<update>
													<property>state/@severity</property>
													<severity>undefined</severity>
												</update>
											</transaction>
										</if>
									</if>
								</if>
							</if>
						</block>
					</rule>
					<rule name="example1 - triggerdetails">
						<targets>
							<target>/geneos/gateway[(@name=&quot;DevOps_Gateway&quot;)]/directory/probe[(@name=&quot;devops_custom_fkm&quot;)]/managedEntity[(@name=&quot;custom_fkm&quot;)]/sampler[(@name=&quot;Logfile example 1&quot;)][(@type=&quot;StandardBank FKM Examples&quot;)]/dataview[(@name=&quot;Logfile example 1&quot;)]/rows/row/cell[(@column=&quot;triggerDetails&quot;)]</target>
						</targets>
						<priority>1</priority>
						<block>
							<if>
								<like>
									<dataItem>
										<property>@value</property>
									</dataItem>
									<string/>
								</like>
								<transaction>
									<update>
										<property>state/@severity</property>
										<severity>undefined</severity>
									</update>
								</transaction>
								<if>
									<unlike>
										<dataItem>
											<property>@value</property>
										</dataItem>
										<string/>
									</unlike>
									<transaction>
										<delay>45</delay>
										<update>
											<property>state/@severity</property>
											<severity>critical</severity>
										</update>
									</transaction>
									<transaction>
										<update>
											<property>state/@severity</property>
											<severity>undefined</severity>
										</update>
									</transaction>
								</if>
							</if>
						</block>
					</rule>
					<rule name="example2 - status">
						<targets>
							<target>/geneos/gateway[(@name=&quot;DevOps_Gateway&quot;)]/directory/probe[(@name=&quot;devops_custom_fkm&quot;)]/managedEntity[(@name=&quot;custom_fkm&quot;)]/sampler[(@name=&quot;Logfile example 2&quot;)][(@type=&quot;StandardBank FKM Examples&quot;)]/dataview[(@name=&quot;Logfile example 2&quot;)]/rows/row[(@name=&quot;/opt/geneos/gateway/resources/standardbank/fkm/example2.log&quot;)]/cell[(@column=&quot;status&quot;)]</target>
						</targets>
						<priority>1</priority>
						<pathAliases>
							<pathAlias name="triggercount">ancestor-or-self::managedEntity/sampler/dataview[(@name=&quot;Logfile example 2&quot;)]/rows/row/cell[(@column=&quot;triggerCount&quot;)]</pathAlias>
						</pathAliases>
						<block>
							<set>
								<var ref="trigger"/>
								<maximum>
									<dataItems>
										<pathAlias ref="triggercount"/>
										<property>state/@severity</property>
									</dataItems>
								</maximum>
							</set>
							<if>
								<like>
									<dataItem>
										<property>@value</property>
									</dataItem>
									<string>OK</string>
								</like>
								<transaction>
									<update>
										<property>state/@severity</property>
										<severity>ok</severity>
									</update>
								</transaction>
								<if>
									<like>
										<dataItem>
											<property>@value</property>
										</dataItem>
										<string>NOT*</string>
									</like>
									<transaction>
										<update>
											<property>state/@severity</property>
											<severity>warning</severity>
										</update>
									</transaction>
									<if>
										<and>
											<like>
												<dataItem>
													<property>@value</property>
												</dataItem>
												<string>FAIL*</string>
											</like>
											<equal>
												<maximum>
													<dataItems>
														<pathAlias ref="triggercount"/>
														<property>state/@severity</property>
													</dataItems>
												</maximum>
												<integer>3</integer>
											</equal>
										</and>
										<transaction>
											<update>
												<property>state/@severity</property>
												<severity>critical</severity>
											</update>
										</transaction>
										<if>
											<and>
												<like>
													<dataItem>
														<property>@value</property>
													</dataItem>
													<string>FAIL*</string>
												</like>
												<equal>
													<maximum>
														<dataItems>
															<pathAlias ref="triggercount"/>
															<property>state/@severity</property>
														</dataItems>
													</maximum>
													<integer>2</integer>
												</equal>
											</and>
											<transaction>
												<update>
													<property>state/@severity</property>
													<severity>warning</severity>
												</update>
											</transaction>
											<transaction>
												<update>
													<property>state/@severity</property>
													<severity>undefined</severity>
												</update>
											</transaction>
										</if>
									</if>
								</if>
							</if>
						</block>
					</rule>
					<rule name="example2 - triggercount">
						<targets>
							<target>/geneos/gateway[(@name=&quot;DevOps_Gateway&quot;)]/directory/probe[(@name=&quot;devops_custom_fkm&quot;)]/managedEntity[(@name=&quot;custom_fkm&quot;)]/sampler[(@name=&quot;Logfile example 2&quot;)][(@type=&quot;StandardBank FKM Examples&quot;)]/dataview[(@name=&quot;Logfile example 2&quot;)]/rows/row/cell[(@column=&quot;triggerCount&quot;)]</target>
						</targets>
						<priority>1</priority>
						<block>
							<if>
								<like>
									<dataItem>
										<property>@value</property>
									</dataItem>
									<string/>
								</like>
								<transaction>
									<update>
										<property>state/@severity</property>
										<severity>undefined</severity>
									</update>
								</transaction>
								<if>
									<gt>
										<dataItem>
											<property>@value</property>
										</dataItem>
										<integer>3</integer>
									</gt>
									<transaction>
										<update>
											<property>state/@severity</property>
											<severity>critical</severity>
										</update>
									</transaction>
									<if>
										<gt>
											<dataItem>
												<property>@value</property>
											</dataItem>
											<integer>2</integer>
										</gt>
										<transaction>
											<update>
												<property>state/@severity</property>
												<severity>warning</severity>
											</update>
										</transaction>
										<transaction>
											<update>
												<property>state/@severity</property>
												<severity>ok</severity>
											</update>
										</transaction>
									</if>
								</if>
							</if>
						</block>
					</rule>
					<rule name="example3 - alerting trigger">
						<targets>
							<target>/geneos/gateway[(@name=&quot;DevOps_Gateway&quot;)]/directory/probe[(@name=&quot;devops_custom_fkm&quot;)]/managedEntity[(@name=&quot;custom_fkm&quot;)]/sampler[(@name=&quot;Logfile example 3&quot;)][(@type=&quot;StandardBank FKM Examples&quot;)]/dataview[(@name=&quot;Logfile example 3&quot;)]/rows/row/cell[(@column=&quot;triggerDetails&quot;)]</target>
						</targets>
						<priority>1</priority>
						<block>
							<if>
								<like>
									<dataItem>
										<property>@value</property>
									</dataItem>
									<string/>
								</like>
								<transaction>
									<update>
										<property>state/@severity</property>
										<severity>undefined</severity>
									</update>
								</transaction>
								<transaction>
									<update>
										<property>state/@severity</property>
										<severity>warning</severity>
									</update>
								</transaction>
							</if>
						</block>
					</rule>
					<rule name="count example4">
						<targets>
							<target>/geneos/gateway[(@name=&quot;DevOps_Gateway&quot;)]/directory/probe[(@name=&quot;devops_custom_fkm&quot;)]/managedEntity[(@name=&quot;custom_fkm&quot;)]/sampler[(@name=&quot;Count Logfile example 4&quot;)][(@type=&quot;StandardBank FKM Examples&quot;)]/dataview[(@name=&quot;Count Logfile example 4&quot;)]/rows/row/cell[(@column=&quot;count&quot;)]</target>
						</targets>
						<priority>1</priority>
						<evaluateOnDataviewSample>true</evaluateOnDataviewSample>
						<block>
							<if>
								<like>
									<dataItem>
										<property>@value</property>
									</dataItem>
									<string/>
								</like>
								<transaction>
									<update>
										<property>state/@severity</property>
										<severity>undefined</severity>
									</update>
								</transaction>
								<transaction>
									<action ref="Count to logfile example4"/>
								</transaction>
							</if>
						</block>
					</rule>
				</ruleGroup>
			</ruleGroup>
		</ruleGroup>
	</rules>
	<alerting>
		<hierarchy name="log to file">
			<priority>1</priority>
			<levels>
				<level>
					<match>
						<managedEntityAttribute>REGION</managedEntityAttribute>
					</match>
				</level>
				<level>
					<match>
						<managedEntityAttribute>CITY</managedEntityAttribute>
					</match>
				</level>
				<level>
					<match>
						<samplerName/>
					</match>
				</level>
			</levels>
			<alert name="AFRICA">
				<alert name="JOHANNESBURG">
					<alert name="Logfile example 3">
						<warning>
							<level>
								<notification>
									<effect ref="Alert to log"/>
								</notification>
							</level>
						</warning>
					</alert>
				</alert>
			</alert>
		</hierarchy>
	</alerting>
</gateway>